---
layout: post
title: "《深入理解计算机系统 第2版》第1章 计算机系统漫游"
description: ""
category: "读书笔记"
tags: [读书笔记,深入理解计算机系统,CSAPP]
---
{% include JB/setup %}

> *把书读厚才叫本事！*

## 摘要

> 这一章通过研究“hello,world”这个简单程序的生命周期，介绍计算机系统的主要概念和主题。

计算机系统是由硬件和系统软件组成的，它们共同工作来运行应用程序。虽然系统的具体实现方式随着时间不断变化，但是系统内在的概念确没有改变。所有计算机系统都有相似的硬件和软件组件，它们执行着相似的功能。一些程序员希望深入了解这些组件是如何工作的，以及这些组件是如何影响程序的正确性和性能的，以此来提高自身的技能。本书便是为这些读者而写的。

> 俺就是啊，俺就是想了解这些啊，可是俺当初不知道有这本书啊。俺深深的感受到信息不对称带来的沉痛伤害。

{% highlight c %}
#include <stdio.h>

int main()
{
	printf("hello, world\n");
}
{% endhighlight %}

我们通过跟踪hello程序的生命周期来开始对系统的学习：从它被程序员创建，到在系统上运行，输出简单的消息，然后终止。

## 1.1 信息就是位+上下文

hello程序的生命周期是从一个源程序开始的，即程序员利用编辑器创建并保存的文本文件，文件名是hello.c。源程序实际上就是一个由值0和1组成的位（bit）序列，8个位被组织成一组，称为字节。每个字节表示程序中某个文本字符。

这里涉及到两个术语：文本文件和二进制文件。

*文本文件*

粗略的定义，只由ASCII字符构成的文件称为文本文件。但是如果包含了汉字等非ASCII字符时，则汉字用机内码表示。

*二进制文件*

非文本文件即为二进制文件。大多数二进制文件的问题在于，理解数据所必需的语境与数据本身是分离的。没有应用逻辑对其进行解析，这些数据是没有意义的。但是，文本文件可以获得自描述（self-describing）的、不依赖于创建它的应用的数据流。

hello.c的表示方法说明了一个基本的思想：系统中所有的信息，包括磁盘文件、存储器中的程序、存储器中存放的用户数据以及网络上传送的数据，都是由一串位表示的。区分不同数据对象的唯一方法是我们读到这些数据对象时的上下文。比如，在不同的上下文中，一个同样的字节序列可能表示一个整数、浮点数、字符串或机器指令。

## 1.2 程序被其他程序翻译成不同的格式

为了在系统上运行hello.c程序，每条C语句都必须被其他程序转化为一系列的低级机器语言指令。然后这些指令按照一种称为可执行目标程序的格式打好包，并以二进制磁盘文件的形式存放起来。目标程序也称为可执行目标文件。

在Unix系统上，从源文件到目标文件的转化是由编译器驱动程序完成的：

	unix> gcc -o hello hello.c

在这里，GCC编译器驱动器读取源程序文件hello.c，并把它翻译成一个可执行目标文件heloo。这个翻译的过程分为四个阶段来完成，如下图所示。执行这四个阶段的程序（预处理、编译器、汇编器和连接器）一起构成了编译系统。

![编译系统]({{ CDN_PATH }}{{ site.img_url }}/2014082701.png)

* 预处理阶段。预处理器（cpp）根据以字符#字符开头的命令，修改原始的C程序。结果就得到另一个C程序，通常是以.i作为文件扩展名。
* 编译阶段。编译器（ccl）将文本文件hello.i翻译成文本文件hello.s，它包含一个汇编语言程序。
* 汇编阶段。汇编器（as）将hello.s翻译成机器语言指令，把这些指令打包成一种叫做可重定位目标程序的格式，并将结果保存在目标文件hello.o中。hello.o是一个二进制文件，它的字节编码是机器语言指令而不是字符。
* 链接阶段。连接器（ld）将各目标文件合并在一起。结果就是hello文件，它是一个可执行目标文件（简称可执行文件），可以被加载到内存中，由系统执行。

### 预处理器

[预处理器-来自维基百科](http://zh.wikipedia.org/wiki/%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8)

[预处理器-来自MSDN](http://msdn.microsoft.com/zh-cn/library/79yewefw.aspx)

预处理器是程序中处理输入数据，产生能用来输入到其他程序的数据的程序。输出被称为输入数据预处理过的形式，常用在之后的程序比如编译器中。所作处理的数量和种类依赖于预处理器的类型，一些预处理只能够执行相对简单的文本替换和宏展开（词法预处理器），而另一些则有着完全成熟的编程语言的能力（句法预处理器）。

词法预处理器是最低级的预处理器，因为它们只需要词法分析，也就是说，它们在语法分析处理之前，根据用户定义的规则，进行简单的词法单元替换。典型的词法预处理器产生宏替换：包含其他文件的文本，并且条件性地编译或者包含文件。

#### C预处理器

最常见的词法预处理器是C预处理器，采用以’#‘为行首的指示。

C程序包含一个或多个源文件，每个源文件包含程序的一些文本。源文件与其包含文件（使用#include预处理器指令包含的文件），但不包含由条件编译指令（如#if）*删除*的代码部分，一起称为*翻译单元*。

TODO 《编译原理》第2、3章