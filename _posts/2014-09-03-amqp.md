---
layout: post
title: "《AMQP》第1部分 概念"
description: "通用中间件标准"
category: "读书笔记"
tags: [读书笔记, amqp]
---
{% include JB/setup %}

版本：0-10

## 1. 概述

### 1.1 文档的作用

该文档定义了一个网络协议：AMQP（Advanced Message Queuing Protocol），遵循该协议的客户应用程序和消息中间件服务器之间可以相互通信。

### 1.2 专利

### 1.3 总览

#### 1.3.1 什么是AMQP

AMQP（Advanced Message Queuing Protocol），遵循该协议的客户应用程序和消息中间件服务器之间可以相互通信。

#### 1.3.2 为什么设计AMQP协议

就是为了整一种通用的消息中间件协议嘛，希望大家都用这种协议。

#### 1.3.3 AMQP包含什么

1. AMQP模块，由一系列组件组成，组件在代理内部路由和存储消息，组件之间通过一些列的规则相互连接。
2. 一个网络层协议：AMQP。客户应用程序通过这个协议与代理通信，与AMQP模块交互。

#### 1.3.4 高级消息队列协议（AMQP）

*AMQP模块*

AMQP模块主要包含下面三个组件：

1. 交换组件：接收来自生产者应用的消息，将消息路由到消息队列。
2. 消息队列组件：存储消息直到消息被消费者应用消费。
3. 捆绑组件：定义消息队列组件和交换组件之间的关系，指定路由规则。

通过上面三个组件可以简单实现中间件的概念：存储转发队列，主题订阅。

> 中间件（Middleware）是提供系统软件和应用软件之间链接的软件，以便于软件各部件之间的沟通。

> 中间件是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源，中间件位于客户机服务器的操作系统之上，管理计算资源和网络通信。

> 消息中间件利用高效可靠的消息传递机制进行平台无关的数据交流，并基于数据通信来进行分布式系统的集成。通过提供消息传递和消息排队模型，它可以在分布式环境下扩展进程间的通信。
> 消息中间件适用于需要可靠的数据传送的分布式环境。采用消息中间件机制的系统中，不同的对象之间通过传递消息来激活对方的事件，完成相应的操作。发送者将消息发送给消息服务器，消息服务器将消息存放在若干队列中，在合适的时候再将消息转发给接收者。消息中间件能在不同平台之间通信，它常被用来屏蔽掉各种平台及协议之间的特性，实现应用程序之间的协同，其优点在于能够在客户和服务器之间提供同步和异步的连接，并且在任何时刻都可以将消息进行传送或者存储转发。

AMQP模块的目标：

1. 支持金融服务行业所需的语义。
2. 提供金融服务行业所需的性能水平。
3. 有心的消息路由和队列仍然容易扩展。
4. 通过协议，服务器所允许的特定语义有应用程序编程指定。
5. 灵活而简单。

*AMQP协议*

![AMQP Protocol]({{ CDN_PATH }}{{ site.img_url }}/2014090501.png)

AMQP分为三层：

1. 模块层定义了一系列的命令，应用程序使用这些命令与服务器交互。
2. 会话层保证从应用程序到服务器的名ing能够可靠传输。
3. 传输层提供框架、多路复用通道、错误检测和数据表示（？data representation）。

#### 1.3.5 包括的功能

支持多种通讯架构：

1. 基于存储转发的多写单读。
2. 基于事务分布的多写多读。
3. 基于发布订阅的多写多读。
4. 基于内容路由的多写多读。
5. 基于排队文件传输的多写多读。
6. 两个结点间的点对点连接。

注：多写多读指多个用户写和多个用户读，多写单读指多个用户写和单个用户读。

### 1.4 文档组织结构

分档份两部分：

1. 概念，介绍AMQP的概念，如何使用AMQP。
2. 技术说明，介绍AMQP语义，包括模块层、会话层和通过网络传输AMQP的方式。

### 1.5 惯例

1. AMQP模块（AMQP Model）：表示关键实体的逻辑框架和语义，由AMQP服务器实现。
2. 连接（Connection）：网络连接，如TCP/IP套接字连接。
3. 会话（Session）：节点之间的命名对话框。在会话上下文中，要保证仅以此交付。
4. 通道（Channel）：在多路复用连接（Connection）中的独立双向流。是会话（Session）的物理连接。即会话是逻辑上的，通道是物理上的，两者对应。
5. 客户端（Client）：AMQP连接或会话的发起者。AMQP不是对称的，即客户端产生和消费消息，服务端将消息入队和路由。
6. 服务端（Server）：一个进程，接收来自客户端的连接，实现AMQP消息队列和路由功能。又叫做代理（broker）。
7. 节点：AMQP会话的一端。一个AMQP连接包括两个节点，一个是客户端，一个是服务端。
8. 帧（Frame）：AMQP的传输单元。一帧是一段的任意片段。
9. 段（Segment）：帧的有序集合，是集合中的一个完整的语法划分。
10. 集合（Assembly）：段的有序集合，一个任务的逻辑单元。
11. 头部（Header）：一种特定类型的段，描述消息数据的属性。
12. 主体（Body）：一种特定类型的段，包括应用数据。主体段完全不透明，服务端不能检查或修改这主体。
13. 内容（Content）：包含在主体段总的消息数据。
14. 控制（Control）：假定在不可靠传输情况下的单向指令。
15. 命令（Command）：需要对方确认的指令。则是可靠传输命令。
16. 类（Class）：AMQP命令集或是控制集，处理一个特定的功能。
17. *交换（Exchange）*：服务端的一个实体从生产者应用程序处获取消息，并把消息路由到服务端的消息队列中。
18. 交换类型（Exchange Type）：基于路由语义的交换分类。
19. 消息队列（Message Queue）：一个命名实体，保存消息知道可以把消息发送给消费者应用程序。
20. 绑定（Binding）：消息队列和交换之间的一种路由关系。
21. 绑定名称（Binding Key）：绑定的名称。
22. 路由名称（Routing Key）：一个消息头，交换可以据此决定如何路由这条消息。
23. 持久的（Durable）：服务端重启后仍然存在的服务端资源。
24. 短暂的（Transient）：服务端重启后会被删除或重置的服务端资源。
25. 永久的（Persistent）：服务端存储在可靠硬盘存储设备中的消息，服务端重启后也不会丢失。
26. 非永久的（Non-Persistent）：服务端存储在内存中的消息，服务端重启后可能丢失。
27. 消费者（Consumer）：客户端应用程序，从消息队列请求数据。
28. 生成在（Producer）：客户端应用程序，向交换发布消息。（注：不是发布到队列）
29. 虚拟主机（Virtual Host）：包含交换、消息队列和关联对象的集合。虚拟主机是一个独立的服务环境，有着相同的认证机制和加密环境。客户端应用程序在登录服务端后选择一个虚拟主机。
30. 主题（Topic）：分发消息，AMQP通过一个或多个类型的交换实现主题。
31. 代理（Broker）：与服务端是一个意思。


## 2 AMQP模块

### 2.1 AMQP模型介绍

### 2.2 虚拟主机

### 2.3 交换机制

### 2.4 消息队列

### 2.5 绑定

### 2.6 消息

### 2.7 订阅

### 2.8 事务

### 2.9 分布式事务

## 3 会话

### 3.1 会话定义

### 3.2 会话功能

### 3.3 传输条件

### 3.4 命令和控制

### 3.5 会话生命期

### 3.6 使用会话控制